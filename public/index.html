<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Booking System</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23FF6B35' stroke-width='2'%3E%3Cpath d='M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z'/%3E%3Cpolyline points='9 22 9 12 15 12 15 22'/%3E%3C/svg%3E">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Stylesheets -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
    
    <!-- Inline theme detection to prevent flash of wrong theme -->
    <script>
        (function() {
            var saved = localStorage.getItem('theme');
            if (!saved) {
                saved = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
            }
            document.documentElement.setAttribute('data-theme', saved);
        })();
    </script>
    
    <!-- External scripts with defer for non-blocking load -->
    <script defer src="/socket.io/socket.io.js"></script>
    <script defer src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
    <script defer src="/auth.js"></script>
    
    <!-- Noscript fallback styles -->
    <noscript>
        <style>
            .noscript-message {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                background: var(--bg-primary, #1a1a2e);
                color: var(--text-primary, #ffffff);
                font-family: 'Outfit', sans-serif;
                text-align: center;
                padding: 2rem;
            }
            .noscript-message svg {
                width: 64px;
                height: 64px;
                stroke: #FF6B35;
                margin-bottom: 1rem;
            }
            .noscript-message h1 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            .noscript-message p {
                color: #a0a0a0;
            }
            .app, .login-overlay { display: none !important; }
        </style>
    </noscript>
</head>
<body>
    <!-- Noscript fallback for users with JavaScript disabled -->
    <noscript>
        <div class="noscript-message">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <h1>JavaScript Required</h1>
            <p>The Office Booking System requires JavaScript to run.</p>
            <p>Please enable JavaScript in your browser settings and refresh the page.</p>
        </div>
    </noscript>
    
    <!-- Login Overlay -->
    <div id="loginOverlay" class="login-overlay visible">
        <div class="login-container">
            <div class="login-logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </div>
            <h1 class="login-title">Office Booking System</h1>
            <p class="login-subtitle">Sign in with your work account to continue</p>
            <button class="login-button" onclick="signIn()">
                <svg viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
                    <rect x="1" y="1" width="9" height="9" fill="#f25022"/>
                    <rect x="11" y="1" width="9" height="9" fill="#7fba00"/>
                    <rect x="1" y="11" width="9" height="9" fill="#00a4ef"/>
                    <rect x="11" y="11" width="9" height="9" fill="#ffb900"/>
                </svg>
                Sign in with Microsoft
            </button>
        </div>
    </div>

    <div class="app" style="display: none;">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Open menu">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <div class="mobile-logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>Office Booking</span>
            </div>
            <button id="mobileThemeToggle" class="theme-toggle" title="Toggle theme">
                <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </header>
        
        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobileOverlay"></div>
        
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </div>
                <span>Office Booking</span>
                <button id="themeToggle" class="theme-toggle" title="Toggle theme">
                    <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
            
            <!-- User Info -->
            <div id="userInfo" class="user-info">
                <div id="userAvatar" class="user-avatar">
                    <span>?</span>
                </div>
                <div class="user-details">
                    <span id="userName" class="user-name">Loading...</span>
                    <button class="sign-out-btn" onclick="signOut()" title="Sign out">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="location-selector">
                <label>Location</label>
                <select id="locationSelect">
                    <!-- Populated dynamically -->
                </select>
            </div>
            
            <div class="capacity-display">
                <div class="capacity-header">
                    <span>Today's Capacity</span>
                    <span id="capacityLabel" class="capacity-badge">0/21</span>
                </div>
                <div class="capacity-bar">
                    <div id="capacityFill" class="capacity-fill" style="width: 0%"></div>
                </div>
            </div>
            
            <nav class="nav-menu">
                <button class="nav-item active" data-view="calendar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Calendar
                </button>
                
                <!-- Settings Menu with Submenu -->
                <div class="nav-item-group">
                    <button class="nav-item has-submenu" id="settingsToggle">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                        Settings
                        <svg class="submenu-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="nav-submenu" id="settingsSubmenu">
                        <button class="nav-item nav-subitem" data-view="teams">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                            Teams
                        </button>
                        <button class="nav-item nav-subitem" data-view="teamRoles">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M22 11h-6"></path>
                                <path d="M19 8v6"></path>
                            </svg>
                            Team Roles
                        </button>
                        <button class="nav-item nav-subitem" data-view="locations">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            Locations
                        </button>
                        <button class="nav-item nav-subitem" data-view="desks">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                <path d="M16 7V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v3"></path>
                                <line x1="12" y1="12" x2="12" y2="17"></line>
                                <line x1="9" y1="14" x2="15" y2="14"></line>
                            </svg>
                            Desks
                        </button>
                        <button class="nav-item nav-subitem" data-view="holidays">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                                <path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01"></path>
                            </svg>
                            Holidays
                        </button>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Calendar View -->
            <div id="calendarView" class="view active">
                <header class="view-header">
                    <div class="month-navigation">
                        <button id="prevMonth" class="nav-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6"></polyline>
                            </svg>
                        </button>
                        <h1 id="currentMonth">January 2026</h1>
                        <button id="nextMonth" class="nav-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="calendar-header-right">
                        <div class="presence" id="presenceBar">
                            <span class="presence-label">Viewing this month:</span>
                            <div class="presence-avatars" id="presenceAvatars"></div>
                            <span class="presence-count" id="presenceCount">0</span>
                        </div>
                        <button id="todayBtn" class="btn btn-secondary">Today</button>
                    </div>
                </header>
                
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header weekend">Sat</div>
                        <div class="calendar-day-header weekend">Sun</div>
                    </div>
                    <div id="calendarGrid" class="calendar-grid">
                        <!-- Calendar days populated by JS -->
                    </div>
                </div>
                
                <!-- Mobile List View -->
                <div id="calendarList" class="calendar-list">
                    <!-- Populated by JS on mobile -->
                </div>
            </div>

            <!-- Teams View -->
            <div id="teamsView" class="view">
                <header class="view-header">
                    <h1>Manage Teams</h1>
                    <button id="addTeamBtn" class="btn btn-primary">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Team
                    </button>
                </header>
                <div id="teamsList" class="teams-list">
                    <!-- Teams populated by JS -->
                </div>
            </div>

            <!-- Locations View -->
            <div id="locationsView" class="view">
                <header class="view-header">
                    <h1>Manage Locations</h1>
                    <button id="addLocationBtn" class="btn btn-primary">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Location
                    </button>
                </header>
                <div id="locationsList" class="locations-list">
                    <!-- Locations populated by JS -->
                </div>
            </div>

            <!-- Desks View -->
            <div id="desksView" class="view">
                <header class="view-header">
                    <h1>Floor Plan</h1>
                    <div class="desk-header-controls">
                        <select id="floorSelect" class="floor-select">
                            <option value="1">1st Floor</option>
                            <option value="2">2nd Floor</option>
                            <option value="3">3rd Floor</option>
                        </select>
                        <input type="date" id="deskDateSelect" class="date-select">
                        <button id="toggleEditMode" class="btn btn-secondary">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Edit Layout
                        </button>
                    </div>
                </header>
                
                <!-- Edit Mode Toolbar -->
                <div id="editModePanel" class="edit-mode-panel" style="display: none;">
                    <div class="edit-toolbar">
                        <div class="toolbar-group">
                            <span class="toolbar-label">Add Elements:</span>
                            <button class="toolbar-btn" data-tool="desk" title="Add Desk">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="8" width="18" height="10" rx="1"></rect>
                                    <line x1="7" y1="18" x2="7" y2="21"></line>
                                    <line x1="17" y1="18" x2="17" y2="21"></line>
                                </svg>
                                <span>Desk</span>
                            </button>
                            <button class="toolbar-btn" data-tool="room" title="Add Room">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="1"></rect>
                                </svg>
                                <span>Room</span>
                            </button>
                            <button class="toolbar-btn" data-tool="wall" title="Add Wall">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="4" y1="12" x2="20" y2="12" stroke-width="4"></line>
                                </svg>
                                <span>Wall</span>
                            </button>
                            <button class="toolbar-btn" data-tool="label" title="Add Label">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 7V4h16v3"></path>
                                    <line x1="12" y1="4" x2="12" y2="20"></line>
                                    <line x1="8" y1="20" x2="16" y2="20"></line>
                                </svg>
                                <span>Label</span>
                            </button>
                        </div>
                        <div class="toolbar-group">
                            <span class="toolbar-label">Selected:</span>
                            <span id="selectedElementInfo" class="selected-info">None</span>
                            <button id="deleteSelectedBtn" class="toolbar-btn danger" style="display: none;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Floor Map Container -->
                <div class="floor-map-wrapper">
                    <div id="floorMapContainer" class="floor-map-container">
                        <div id="floorMap" class="floor-map">
                            <!-- Floor elements and desks rendered here -->
                        </div>
                    </div>
                    
                    <!-- Legend -->
                    <div class="floor-map-legend">
                        <span class="legend-item"><span class="legend-dot hotseat"></span> Hotseat</span>
                        <span class="legend-item"><span class="legend-dot unavailable"></span> Unavailable</span>
                        <span class="legend-item"><span class="legend-dot team-seat"></span> Team Seat</span>
                        <span class="legend-item"><span class="legend-dot occupied"></span> Booked</span>
                        <span class="legend-item"><span class="legend-dot my-booking"></span> Your Booking</span>
                    </div>
                </div>
                
                <!-- Selected Desk Info -->
                <div id="selectedDeskPanel" class="selected-desk-panel" style="display: none;">
                    <div class="selected-desk-header">
                        <span id="selectedDeskName">DESK-01</span>
                        <button class="btn btn-primary" id="applyDeskBtn">Apply</button>
                    </div>
                </div>
            </div>

            <!-- Holidays View -->
            <div id="holidaysView" class="view">
                <header class="view-header">
                    <h1>Public Holidays</h1>
                    <div class="holiday-actions">
                        <select id="holidayYearSelect" class="year-select">
                            <!-- Populated by JS -->
                        </select>
                        <button id="fetchHolidaysBtn" class="btn btn-primary">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.66 0 3-4.03 3-9s-1.34-9-3-9m0 18c-1.66 0-3-4.03-3-9s1.34-9 3-9"></path>
                            </svg>
                            Fetch SA Holidays
                        </button>
                    </div>
                </header>
                <p class="view-description">Public holidays are excluded from bookings. Use the button above to fetch official South African holidays from the internet.</p>
                <div id="holidaysList" class="holidays-list">
                    <!-- Holidays populated by JS -->
                </div>
            </div>

            <!-- Team Roles View -->
            <div id="teamRolesView" class="view">
                <header class="view-header">
                    <h1>Team Lead Roles</h1>
                    <button id="refreshRolesBtn" class="btn btn-secondary">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.66 0 3-4.03 3-9s-1.34-9-3-9m0 18c-1.66 0-3-4.03-3-9s1.34-9 3-9"></path>
                        </svg>
                        Refresh from Azure AD
                    </button>
                </header>
                <p class="view-description">Select which job titles from Azure AD are allowed to lead teams. When creating a team, only people with these job titles will appear in the manager dropdown.</p>
                
                <div class="team-roles-container">
                    <div class="roles-section">
                        <h3>Available Job Titles</h3>
                        <p class="section-hint">These are all job titles found in your Azure AD organization.</p>
                        <div id="jobTitlesList" class="job-titles-list">
                            <div class="loading-spinner">Loading job titles from Azure AD...</div>
                        </div>
                    </div>
                    
                    <div class="roles-section">
                        <h3>Allowed Team Lead Roles</h3>
                        <p class="section-hint">People with these job titles can be selected as team managers.</p>
                        <div id="allowedRolesList" class="allowed-roles-list">
                            <p class="empty-state">No roles selected yet. Click on job titles above to allow them.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Book Office Space</h2>
                <button class="modal-close" onclick="closeModal()" aria-label="Close booking modal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="bookingForm" novalidate>
                <input type="hidden" id="bookingId">
                <input type="hidden" id="bookingDate">
                
                <div class="form-group">
                    <label>Date</label>
                    <div id="selectedDate" class="selected-date"></div>
                </div>
                
                <div class="form-group">
                    <label for="teamSelect">Team</label>
                    <select id="teamSelect">
                        <!-- Populated dynamically -->
                    </select>
                </div>
                
                <div class="form-group" id="peopleCountGroup" style="display: none;">
                    <label for="peopleCount">Number of People</label>
                    <input type="number" id="peopleCount" min="1" max="21" value="1">
                    <span id="availableSpots" class="hint"></span>
                </div>
                
                <div class="form-group" id="teamMemberInfo">
                    <label>Team Info</label>
                    <div id="bookingTeamInfo" class="selected-date"></div>
                </div>
                
                <div class="form-group">
                    <label for="bookingNotes">Notes <span id="notesRequiredLabel" style="display:none; color: var(--danger);">(Required - explain overbooking)</span></label>
                    <textarea id="bookingNotes" rows="2" placeholder="Any additional notes..."></textarea>
                </div>
                
                <div id="overbookingWarning" class="overbooking-warning" style="display:none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <div>
                        <strong>Capacity Exceeded</strong>
                        <p id="overbookingMessage">This booking will exceed the daily capacity. Please provide a reason in the notes.</p>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Booking</button>
                </div>
            </form>
            
            <!-- Existing bookings for this day -->
            <div id="dayBookings" class="day-bookings">
                <h3>Bookings for this day</h3>
                <div id="dayBookingsList"></div>
            </div>
        </div>
    </div>

    <!-- Team Modal -->
    <div id="teamModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="teamModalTitle">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="teamModalTitle">Add Team</h2>
                <button class="modal-close" onclick="closeTeamModal()" aria-label="Close team modal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="teamForm">
                <input type="hidden" id="teamId">
                <div class="form-group">
                    <label for="teamLocation">Office Location</label>
                    <select id="teamLocation" required>
                        <!-- Populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="teamName">Team Name</label>
                    <input type="text" id="teamName" required placeholder="e.g. Engineering">
                </div>
                <div class="form-group">
                    <label>Manager / SM</label>
                    <div class="manager-selector">
                        <input type="hidden" id="teamManagerId">
                        <button type="button" id="selectManagerBtn" class="btn btn-secondary" onclick="openManagerSelector()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            Select from Azure AD
                        </button>
                        <div id="managerDropdown" class="manager-dropdown"></div>
                        <div id="selectedManagerDisplay" class="manager-selected" style="display:none">
                            <div id="selectedManagerAvatar" class="manager-option-avatar"></div>
                            <div class="manager-selected-info">
                                <span id="selectedManagerName" class="manager-selected-name"></span>
                                <span id="selectedManagerMeta" class="manager-selected-meta"></span>
                            </div>
                            <button type="button" class="clear-btn" onclick="clearSelectedManager()" title="Clear selection">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <input type="text" id="teamManager" placeholder="Or type name manually" style="margin-top: 0.5rem">
                    </div>
                </div>
                <div class="form-group">
                    <label for="teamManagerImage">Manager Photo URL</label>
                    <input type="url" id="teamManagerImage" placeholder="Auto-filled from Azure AD or paste URL">
                    <span class="hint">Auto-populated when selecting from Azure AD</span>
                </div>
                <div class="form-group">
                    <label for="teamMemberCount">Number of Team Members</label>
                    <input type="number" id="teamMemberCount" min="0" max="50" value="1" required>
                    <span id="memberCountHint" class="hint" style="display:none"></span>
                </div>
                <div class="form-group">
                    <label for="teamColor">Team Color</label>
                    <input type="color" id="teamColor" value="#3B82F6">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTeamModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="teamFormSubmitBtn">Add Team</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Location Modal -->
    <div id="locationModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="locationModalTitle">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="locationModalTitle">Add Location</h2>
                <button class="modal-close" onclick="closeLocationModal()" aria-label="Close location modal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="locationForm">
                <input type="hidden" id="editLocationId">
                <div class="form-group">
                    <label for="locationName">Location Name</label>
                    <input type="text" id="locationName" required placeholder="e.g. London Office">
                </div>
                <div class="form-group">
                    <label for="locationAddress">Address</label>
                    <input type="text" id="locationAddress" placeholder="e.g. 123 Main Street, Johannesburg">
                    <span class="hint">Full address of the office location</span>
                </div>
                <div class="form-group">
                    <label for="locationCapacity">Daily Capacity (max people per day)</label>
                    <input type="number" id="locationCapacity" min="1" value="21" required>
                </div>
                <div class="form-group">
                    <label for="locationFloors">Number of Floors</label>
                    <input type="number" id="locationFloors" min="1" max="50" value="1" required>
                    <span class="hint">How many floors does this location have?</span>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeLocationModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="locationFormSubmitBtn">Add Location</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Desk Modal -->
    <div id="deskModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="deskModalTitle">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="deskModalTitle">Add Desk</h2>
                <button class="modal-close" onclick="closeDeskModal()" aria-label="Close desk modal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="deskForm">
                <input type="hidden" id="editDeskId">
                <div class="form-group">
                    <label for="deskLocationInput">Location</label>
                    <select id="deskLocationInput" required>
                        <!-- Populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="deskName">Desk Name/Number</label>
                    <input type="text" id="deskName" required placeholder="e.g. Desk A1, Hot Desk 5">
                </div>
                <div class="form-group">
                    <label for="deskFloor">Floor (optional)</label>
                    <input type="text" id="deskFloor" placeholder="e.g. Ground, 1st, 2nd">
                </div>
                <div class="form-group">
                    <label for="deskZone">Zone/Area (optional)</label>
                    <input type="text" id="deskZone" placeholder="e.g. North Wing, Open Plan">
                </div>
                <div class="form-group">
                    <label for="deskType">Desk Type</label>
                    <select id="deskType">
                        <option value="hotseat">Hotseat (Anyone can book)</option>
                        <option value="team_seat">Team Seat (Assigned team only)</option>
                        <option value="unavailable">Unavailable</option>
                    </select>
                </div>
                <div class="form-group" id="assignedTeamGroup" style="display: none;">
                    <label for="assignedTeamId">Assigned Team</label>
                    <select id="assignedTeamId">
                        <!-- Populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Chair Positions</label>
                    <div class="chair-position-grid">
                        <label class="chair-checkbox"><input type="checkbox" name="chairPos" value="top"> Top</label>
                        <label class="chair-checkbox"><input type="checkbox" name="chairPos" value="bottom" checked> Bottom</label>
                        <label class="chair-checkbox"><input type="checkbox" name="chairPos" value="left"> Left</label>
                        <label class="chair-checkbox"><input type="checkbox" name="chairPos" value="right"> Right</label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="deskWidth">Width (px)</label>
                        <input type="number" id="deskWidth" value="60" min="30" max="200">
                    </div>
                    <div class="form-group form-group-half">
                        <label for="deskHeight">Height (px)</label>
                        <input type="number" id="deskHeight" value="40" min="20" max="150">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDeskModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="deskFormSubmitBtn">Add Desk</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Room Modal -->
    <div id="roomModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="roomModalTitle">Add Room</h2>
                <button class="modal-close" onclick="closeRoomModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="roomForm">
                <input type="hidden" id="editRoomId">
                <div class="form-group">
                    <label for="roomLabel">Room Name</label>
                    <input type="text" id="roomLabel" required placeholder="e.g. Meeting Room, Kitchen">
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="roomWidth">Width (px)</label>
                        <input type="number" id="roomWidth" value="150" min="50" max="500">
                    </div>
                    <div class="form-group form-group-half">
                        <label for="roomHeight">Height (px)</label>
                        <input type="number" id="roomHeight" value="120" min="50" max="400">
                    </div>
                </div>
                <div class="form-group">
                    <label for="roomColor">Room Color</label>
                    <input type="color" id="roomColor" value="#3b82f6" class="color-input">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeRoomModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Room</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Label Modal -->
    <div id="labelModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Add Label</h2>
                <button class="modal-close" onclick="closeLabelModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="labelForm">
                <input type="hidden" id="editLabelId">
                <div class="form-group">
                    <label for="labelText">Label Text</label>
                    <input type="text" id="labelText" required placeholder="e.g. OPEN PLAN, RECEPTION">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeLabelModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Label</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Wall Modal -->
    <div id="wallModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Add Wall</h2>
                <button class="modal-close" onclick="closeWallModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="wallForm">
                <input type="hidden" id="editWallId">
                <div class="form-group">
                    <label for="wallLength">Length (px)</label>
                    <input type="number" id="wallLength" value="100" min="20" max="800">
                </div>
                <div class="form-group">
                    <label for="wallThickness">Thickness (px)</label>
                    <input type="number" id="wallThickness" value="6" min="2" max="20">
                </div>
                <div class="form-group">
                    <label>Orientation</label>
                    <div class="wall-orientation-options">
                        <label class="orientation-option">
                            <input type="radio" name="wallOrientation" value="0" checked>
                            <span class="orientation-preview horizontal"></span>
                            <span>Horizontal</span>
                        </label>
                        <label class="orientation-option">
                            <input type="radio" name="wallOrientation" value="90">
                            <span class="orientation-preview vertical"></span>
                            <span>Vertical</span>
                        </label>
                        <label class="orientation-option">
                            <input type="radio" name="wallOrientation" value="45">
                            <span class="orientation-preview diagonal-down"></span>
                            <span>Diagonal ↘</span>
                        </label>
                        <label class="orientation-option">
                            <input type="radio" name="wallOrientation" value="-45">
                            <span class="orientation-preview diagonal-up"></span>
                            <span>Diagonal ↗</span>
                        </label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeWallModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Wall</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Desk Booking Modal -->
    <div id="deskBookingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="deskBookingModalTitle">Book Desk</h2>
                <button class="modal-close" onclick="closeDeskBookingModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="desk-booking-content">
                <div class="desk-info-header">
                    <div id="deskBookingInfo"></div>
                </div>
                <form id="deskBookingForm">
                    <input type="hidden" id="bookingDeskId">
                    <input type="hidden" id="bookingDate">
                    
                    <div class="form-group">
                        <label for="employeeName">Your Name</label>
                        <input type="text" id="employeeName" required placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label for="employeeEmail">Email (optional)</label>
                        <input type="email" id="employeeEmail" placeholder="your.email@company.com">
                    </div>
                    <div class="form-group">
                        <label for="deskBookingTeam">Team (optional)</label>
                        <select id="deskBookingTeam">
                            <option value="">-- No team --</option>
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeDeskBookingModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="deskBookingSubmitBtn">Book Desk</button>
                    </div>
                </form>
            </div>
            <div class="desk-bookings-list">
                <h3>Today's Bookings</h3>
                <div id="deskBookingsList"></div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications - aria-live for screen reader announcements -->
    <div id="toastContainer" class="toast-container" role="status" aria-live="polite" aria-atomic="true"></div>

    <!-- Team Hover Tooltip -->
    <div id="teamTooltip" class="team-tooltip">
        <div class="tooltip-content">
            <div class="tooltip-avatar" id="tooltipAvatar"></div>
            <div class="tooltip-info">
                <span class="tooltip-team-name" id="tooltipTeamName"></span>
                <span class="tooltip-manager" id="tooltipManager"></span>
                <span class="tooltip-members" id="tooltipMembers"></span>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="/js/main.js"></script>
</body>
</html>

